#!/bin/csh -f
#
# Update disk loop from remote and break connection when
# current.  This is meant for bringing in data from places
# where a continuous feed isn't practical or permitted
# (such as NIL)

set debug  = 1
set myname = isiRequestOnce

if ($debug) logger -t $myname"[$$]" -p user.info "begin"

# General setup

set setup  = ~nrts/scripts/ScriptSetup
if (! -e $setup ) then
    set message = "missing $setup"
    logger -t $myname"[$$]" -p user.info "$message"
    echo "${myname}: $message"
    goto failure
endif
source $setup
if ($debug) logger -t $myname"[$$]" -p user.info "$setup OK"

if ($#argv != 3) then
    set message = "bad command line"
    logger -t $myname"[$$]" -p user.info "$message"
    echo "${myname}: $message"
    echo "usage: $myname server sta"
    goto failure
endif

set server = $argv[1]
set sta    = $argv[2]
set maxdur = $argv[3]
set timeout = 60

set command = "isidl isi=${server} $sta end=newest log=syslogd:user to=$timeout maxdur=$maxdur -nosync"
if ($debug) logger -t $myname"[$$]" -p user.info "$command"
$command

if ($debug) logger -t $myname"[$$]" -p user.info "completed OK"
exit 0

failure:
logger -t $myname"[$$]" -p user.info "exit 1"
exit 1

# Revision History
#
# $Log: isiRequestOnce,v $
# Revision 1.2  2016/07/28 18:25:16  dechavez
# fixed bug in arg count check
#
# Revision 1.1  2016/07/28 18:22:06  dechavez
# committed
#
